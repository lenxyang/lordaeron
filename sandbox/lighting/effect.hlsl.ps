// using row_major
#pragma pack_matrix(row_major)

struct VsOutput {
  float4 position:SV_POSITION;
  float4 normal:NORMAL;
  float4 viewin: VIEWIN;
};

struct DirLight {
  float4 diffuse;
  float4 ambient;
  float4 specular;
  float3 dir;
  float  pad;
};

cbuffer c_buffer {
   float4 color;
   DirLight light;
};

float4 ps_main(VsOutput o):SV_TARGET {
  float ldir = normalize(light.dir.xyz);
  float diffuse_factor = clamp(dot(normalize(o.normal.xyz),	
                               -light.dir), 0.0f, 1.0f);
  float3 light_intensity = light.ambient.xyz + (light.diffuse.xyz * diffuse_factor);
  float3 reflect = normalize(2.0f * dot(o.normal.xyz, ldir) * o.normal.xyz - ldir);
  float3 specular_intensity  = pow(2, max(0, dot(reflect, o.viewin))) * light.diffuse;
  light_intensity += specular_intensity;
  return float4(light_intensity * color.xyz, color.a);
}
